[tool:pytest]
# Pytest configuration for the trading system

# Test discovery
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Test directories
testpaths = tests

# Minimum version
minversion = 6.0

# Add options
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=trading_system_v2
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=80
    --durations=10
    --maxfail=5
    -ra

# Markers
markers =
    unit: Unit tests
    integration: Integration tests
    e2e: End-to-end tests
    slow: Slow running tests
    fast: Fast running tests
    api: API tests
    database: Database tests
    network: Network dependent tests
    live_data: Tests requiring live market data
    paper_trading: Paper trading tests
    backtest: Backtesting tests
    risk: Risk management tests
    portfolio: Portfolio management tests
    orders: Order management tests
    news: News analysis tests
    research: Research tool tests
    agents: CrewAI agent tests
    tools: Tool tests
    config: Configuration tests
    performance: Performance tests
    security: Security tests
    mock: Tests using mocked data
    real: Tests using real data (use sparingly)
    broker_alpaca: Alpaca broker tests
    broker_ib: Interactive Brokers tests
    data_yahoo: Yahoo Finance data tests
    data_alpha_vantage: Alpha Vantage data tests
    data_polygon: Polygon.io data tests
    data_finnhub: Finnhub data tests
    ml: Machine learning tests
    ta: Technical analysis tests
    fundamental: Fundamental analysis tests
    sentiment: Sentiment analysis tests
    websocket: WebSocket tests
    async_test: Asynchronous tests
    timeout: Tests with custom timeouts
    flaky: Flaky tests that may need retries
    skip_ci: Skip in CI environment
    local_only: Run only in local environment

# Filtering
# Run fast tests by default, use -m "not slow" to exclude slow tests
# Use -m "slow" to run only slow tests
# Use -m "integration" to run integration tests
# Use -m "unit and not slow" for fast unit tests

# Timeout settings
timeout = 300
timeout_method = thread

# Asyncio settings
asyncio_mode = auto

# Warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:yfinance.*
    ignore::FutureWarning:pandas.*
    ignore::RuntimeWarning:numpy.*
    error::UserWarning:trading_system_v2.*

# Environment variables for testing
env =
    TESTING = true
    LOG_LEVEL = WARNING
    DATABASE_URL = sqlite:///test.db
    CACHE_DISABLED = true
    RATE_LIMIT_DISABLED = true
    MOCK_EXTERNAL_APIS = true